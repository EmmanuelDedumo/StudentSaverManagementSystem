<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'userprofile.css' %}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Sidebar inclusion -->
    {% include 'navbar.html' %}
    {% include 'sidebar.html' %}

    <!-- Main Dashboard -->
    <div class="main-dashboard">
        <div class="header">
            <h1>Your Profile</h1>
        </div>

        <form id="profile-form" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
        
            <!-- Profile Picture Section -->
            <div class="profile-picture-section">
                <img id="profile_picture_preview" 
     src="{% if user.profile.profile_picture %}{{ user.profile.profile_picture.url }}{% else %}{% static 'default_profile.png' %}{% endif %}" 
     alt="Profile Picture" class="profile-picture">

                <div class="profile-actions">
                    <input type="file" id="profile_picture_input" name="profile_picture" accept="image/*" style="display: none;" onchange="previewImage(event)">
                    <button type="button" class="btn btn-upload" onclick="document.getElementById('profile_picture_input').click()">Change Picture</button>
                    <button type="button" class="btn btn-delete">Delete Picture</button>
                </div>
            </div>
        
            <!-- Personal Information Section -->
            <div class="personal-info">
                <h3><i class="fas fa-user"></i> Personal Information</h3>
        
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" name="username" value="{{ user.username }}" required>
                </div>
        
                <div class="form-group">
                    <label for="first_name">First Name</label>
                    <input type="text" id="first_name" name="first_name" value="{{ user.first_name }}" required>
                </div>
        
                <div class="form-group">
                    <label for="last_name">Last Name</label>
                    <input type="text" id="last_name" name="last_name" value="{{ user.last_name }}" required>
                </div>
        
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" value="{{ user.email }}" required>
                </div>
            </div>
        
            <div class="form-group">
                <label for="password">New Password</label>
                <input type="password" id="password" name="password" placeholder="Leave empty to keep current password">
            </div>
        
            <button type="submit" class="btn btn-primary save-button">Save Changes</button>
        </form>
    </div>

    <script>
        // Preview the image before upload
        function previewImage(event) {
            var reader = new FileReader();
            reader.onload = function() {
                var output = document.getElementById('profile_picture_preview');
                output.src = reader.result;
            };
            reader.readAsDataURL(event.target.files[0]);
        }

        // When the profile form is submitted and profile picture is updated
        function updateProfilePicture(event) {
            event.preventDefault();

            var form = document.getElementById('profile-form');
            var formData = new FormData(form);

            fetch("{% url 'user_profile' %}", {
                method: "POST",
                body: formData,
            })
            .then(response => response.json())
            .then(data => {
                // Update the profile picture in the navbar
                document.getElementById('profileIcon').src = data.profile_picture_url;
                // Optionally, update the username or other fields in the navbar as well
            })
            .catch(error => {
                console.log("Error updating profile:", error);
            });
        }
    </script>
</body>
</html>
